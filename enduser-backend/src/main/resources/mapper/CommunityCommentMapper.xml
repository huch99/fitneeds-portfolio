<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.community.mapper.CommunityCommentMapper">

    <!--
        USER ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
        - íŠ¹ì • ê²Œì‹œê¸€(postId)ì— ëŒ€í•œ ëŒ“ê¸€
        - ê´€ë¦¬ìžì— ì˜í•´ ìˆ¨ê¹€ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ëŒ“ê¸€ë§Œ ì¡°íšŒ
        - comment_visible = 1
    -->
    <select id="selectVisibleCommentsByPostId"
            parameterType="long"
            resultType="com.project.app.community.dto.CommunityCommentDto">

        SELECT
            comment_id    AS commentId,
            post_id       AS postId,
            writer_id     AS writerId,
            writer_type   AS writerType,
            content,
            created_at    AS createdAt
        FROM community_comment
        WHERE post_id = #{postId}
          AND comment_visible = 1
        ORDER BY comment_id ASC

    </select>

    <!-- =========================
         ðŸ”’ ëŒ“ê¸€ ìž‘ì„±ìž ë³¸ì¸ ì—¬ë¶€ ì²´í¬
         ========================= -->
    <select id="countByCommentIdAndWriterId"
            resultType="int">
        SELECT COUNT(*)
        FROM community_comment
        WHERE comment_id = #{commentId}
          AND writer_id = #{writerId}
          AND comment_visible = 1
    </select>

    <!-- =========================
         âœï¸ ëŒ“ê¸€ ìˆ˜ì • (ë³¸ì¸ë§Œ)
         ========================= -->
   <update id="updateCommentContent">
  UPDATE community_comment
  SET
    content = #{content}
  WHERE comment_id = #{commentId}
    AND writer_id = #{writerId}
    AND comment_visible = 1
</update>


	<!-- =========================
         ðŸ—‘ ëŒ“ê¸€ ì‚­ì œ (ë³¸ì¸ë§Œ)
         ========================= -->
    <delete id="deleteCommentByWriter">
        DELETE
        FROM community_comment
        WHERE comment_id = #{commentId}
          AND writer_id = #{writerId}
    </delete>

</mapper>
