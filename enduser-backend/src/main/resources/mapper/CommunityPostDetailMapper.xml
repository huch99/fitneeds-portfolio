<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.community.mapper.CommunityPostDetailMapper">

  <!-- ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ (USER) -->
  <select id="selectVisiblePostDetail"
          resultType="com.project.app.community.dto.CommunityPostDto">
    SELECT
      post_id          AS postId,
      post_type        AS postType,
      category,
      title,
      content,
      writer_id        AS writerId,
      writer_type      AS writerType,
      branch_id        AS branchId,
      views,
      created_at       AS createdAt,
      updated_at       AS updatedAt,
      sport_type       AS sportType,
      recruit_max      AS recruitMax,
      recruit_end_date AS recruitEndDate
    FROM community_post
    WHERE post_id = #{postId}
      AND post_visible = 1
  </select>

  <!-- ðŸ”¥ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ ì¦ê°€ (USER ì „ìš©, ì¤‘ë³µ í—ˆìš©) -->
  <update id="increaseViewCount">
    UPDATE community_post
    SET views = views + 1
    WHERE post_id = #{postId}
      AND post_visible = 1
  </update>

  <!-- ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ (USER) -->
  <select id="selectVisibleCommentsByPostId"
          resultType="com.project.app.community.dto.CommunityCommentDto">
    SELECT
      comment_id   AS commentId,
      post_id      AS postId,
      writer_id    AS writerId,
      writer_type  AS writerType,
      content,
      created_at   AS createdAt
    FROM community_comment
    WHERE post_id = #{postId}
      AND comment_visible = 1
    ORDER BY comment_id ASC
  </select>

  <!-- ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ìž‘ì„± (USER) -->
  <insert id="insertComment">
    INSERT INTO community_comment (
      post_id,
      writer_id,
      writer_type,
      content,
      comment_visible,
      created_at
    ) VALUES (
      #{postId},
      #{writerId},
      #{writerType},
      #{content},
      1,
      NOW()
    )
  </insert>

</mapper>
