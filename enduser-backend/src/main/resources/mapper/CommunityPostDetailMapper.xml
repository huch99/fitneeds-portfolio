<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.community.mapper.CommunityPostDetailMapper">

  <!-- =========================
       ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ (USER)
       ğŸ”¥ writerId String ê¸°ì¤€ í†µì¼
  ========================= -->
  <select id="selectVisiblePostDetail"
          resultType="com.project.app.community.dto.CommunityPostDto">
    SELECT
      post_id,
      post_type,
      category,
      title,
      content,

      -- ğŸ”¥ í•µì‹¬ ìˆ˜ì •: ì‘ì„±ì IDë¥¼ Stringìœ¼ë¡œ ë³€í™˜
      CAST(writer_id AS CHAR) AS writer_id,

      writer_type,
      branch_id,
      views,
      created_at,
      updated_at,

      -- ëª¨ì§‘ ê´€ë ¨
      sport_type       AS sportType,
      recruit_max      AS recruitMax,
      recruit_end_date AS recruitEndDate

    FROM community_post
    WHERE post_id = #{postId}
      AND post_visible = 1
  </select>

  <!-- =========================
       ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ (USER)
       ğŸ”¥ ëŒ“ê¸€ ì‘ì„±ì IDë„ String ê¸°ì¤€
  ========================= -->
  <select id="selectVisibleCommentsByPostId"
          resultType="com.project.app.community.dto.CommunityCommentDto">
    SELECT
      comment_id     AS commentId,
      post_id        AS postId,

      -- ğŸ”¥ í•µì‹¬ ìˆ˜ì •
      CAST(writer_id AS CHAR) AS writerId,

      writer_type    AS writerType,
      content,
      created_at     AS createdAt
    FROM community_comment
    WHERE post_id = #{postId}
      AND comment_visible = 1
    ORDER BY comment_id ASC
  </select>

  <!-- =========================
       ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ì‘ì„± (USER)
  ========================= -->
  <insert id="insertComment">
    INSERT INTO community_comment (
      post_id,
      writer_id,
      writer_type,
      content,
      comment_visible,
      created_at
    ) VALUES (
      #{postId},
      #{writerId},
      #{writerType},
      #{content},
      1,
      NOW()
    )
  </insert>

</mapper>
