<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.notice.mapper.NoticeMapper">

    <!-- =========================
         USER ê³µì§€ ëª©ë¡ ì¡°íšŒ
         - ìˆ¨ê¹€ ì œì™¸
         - ì¢…ë£Œëœ ê³µì§€ ì œì™¸
         - ìƒì‹œ ê³µì§€ëŠ” ìœ ì§€
    ========================= -->
    <select id="selectNoticeList"
            resultType="com.project.app.notice.dto.NoticeDto">

        SELECT
            post_id     AS postId,
            title       AS title,
            content     AS content,
            views       AS views,
            display_end AS displayEnd,   <!-- ðŸ”¥ ì¶”ê°€ -->
            created_at  AS createdAt
        FROM community_post
        WHERE post_type = 'NOTICE'
          AND is_visible = 1
          AND (
                display_end IS NULL
                OR display_end >= NOW()
          )
        ORDER BY created_at DESC

    </select>

    <!-- =========================
         USER ê³µì§€ ìƒì„¸ ì¡°íšŒ
         - ìˆ¨ê¹€ ì œì™¸
         - ì¢…ë£Œëœ ê³µì§€ ì ‘ê·¼ ë¶ˆê°€
    ========================= -->
    <select id="selectNoticeDetail"
            parameterType="long"
            resultType="com.project.app.notice.dto.NoticeDto">

        SELECT
            post_id     AS postId,
            title       AS title,
            content     AS content,
            views       AS views,
            display_end AS displayEnd,   <!-- ðŸ”¥ ì¶”ê°€ -->
            created_at  AS createdAt
        FROM community_post
        WHERE post_id = #{postId}
          AND post_type = 'NOTICE'
          AND is_visible = 1
          AND (
                display_end IS NULL
                OR display_end >= NOW()
          )

    </select>

    <!-- =========================
         ì¡°íšŒìˆ˜ ì¦ê°€
         - ìˆ¨ê¹€/ì¢…ë£Œ ê³µì§€ëŠ” ì¦ê°€ ì•ˆ ë¨
    ========================= -->
    <update id="increaseViews" parameterType="long">

        UPDATE community_post
        SET views = IFNULL(views, 0) + 1,
            updated_at = NOW()
        WHERE post_id = #{postId}
          AND post_type = 'NOTICE'
          AND is_visible = 1
          AND (
                display_end IS NULL
                OR display_end >= NOW()
          )

    </update>

</mapper>
