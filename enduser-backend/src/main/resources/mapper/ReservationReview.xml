<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.review.mapper.ReservationReviewMapper">

    <select id="selectCompletedReservationsForReview"
            parameterType="string"
            resultType="com.project.app.review.dto.ReservationReviewDto">

        SELECT
            r.rsv_id           AS reservationId,
            r.rsv_dt           AS exerciseDate,
            p.prog_nm          AS productName,
            ua.user_name       AS teacherName,
            NULL               AS facilityName,
            NULL               AS rating,
            NULL               AS content,
            r.reg_dt           AS registrationDateTime
        FROM reservation r
        LEFT JOIN schedule s
               ON r.schd_id = s.schd_id
        LEFT JOIN program p
               ON s.prog_id = p.prog_id
        LEFT JOIN users_admin ua
               ON s.user_id = ua.user_id
        WHERE r.user_id = #{userId}
          AND r.stts_cd = 'COMPLETED'
        ORDER BY r.rsv_dt DESC

    </select>

</mapper>
