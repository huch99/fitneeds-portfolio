<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.community.mapper.AdminCommunityCommentMapper">

  <!-- ADMIN 댓글 목록 조회 (전체 조회) -->
  <select id="selectCommentsByPostIdPaged"
          resultType="com.project.app.community.dto.CommunityCommentDto">
		SELECT
		c.comment_id AS commentId,
		c.post_id AS postId,
		c.writer_id AS writerId,
		c.writer_type AS writerType,

		u.email AS writer_email,

		c.content,
		c.created_at AS createdAt,
		c.comment_visible AS commentVisible
		FROM COMMUNITY_COMMENT c
		LEFT JOIN USERS u
		ON c.writer_type = 'USER'
		AND c.writer_id = u.user_id
		WHERE c.post_id = #{postId}
		ORDER BY c.comment_id DESC

  </select>

  <!-- ADMIN 댓글 전체 개수 -->
  <select id="selectCommentCountByPostId" resultType="int">
    SELECT COUNT(*)
    FROM COMMUNITY_COMMENT
    WHERE post_id = #{postId}
  </select>

  <!-- 숨김 / 보이기 -->
  <update id="updateCommentVisible">
    UPDATE COMMUNITY_COMMENT
    SET comment_visible = #{commentVisible}
    WHERE comment_id = #{commentId}
  </update>

  <!-- 삭제 -->
  <delete id="deleteComment">
    DELETE FROM COMMUNITY_COMMENT
    WHERE comment_id = #{commentId}
  </delete>
	
   <delete id="deleteByPostId" parameterType="long">
    DELETE FROM COMMUNITY_COMMENT
    WHERE post_id = #{postId}
   </delete>	
	
</mapper>
