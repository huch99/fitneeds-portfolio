<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.notice.mapper.AdminNoticeMapper">

    <!-- =========================
         공지사항 목록 조회 (ADMIN)
         - 숨김 여부 무관
         - post_type = NOTICE
    ========================= -->
    <select id="selectNoticeList"
            resultType="com.project.app.notice.dto.NoticeDto">

        SELECT
            post_id,
            post_type,
            title,
            content,
            writer_id,
            writer_type,
            branch_id,
            views,
            is_visible,
            created_at,
            updated_at
        FROM community_post
        WHERE post_type = 'NOTICE'
        ORDER BY created_at DESC

    </select>

    <!-- =========================
         공지사항 상세 조회 (ADMIN)
    ========================= -->
    <select id="selectNoticeDetail"
            parameterType="long"
            resultType="com.project.app.notice.dto.NoticeDto">

        SELECT
            post_id,
            post_type,
            title,
            content,
            writer_id,
            writer_type,
            branch_id,
            views,
            is_visible,
            created_at,
            updated_at
        FROM community_post
        WHERE post_id = #{postId}
          AND post_type = 'NOTICE'

    </select>

    <!-- =========================
         공지사항 등록 (ADMIN)
    ========================= -->
    <insert id="insertNotice"
            parameterType="com.project.app.notice.dto.NoticeDto"
            useGeneratedKeys="true"
            keyProperty="postId">

        INSERT INTO community_post
        (
            post_type,
            title,
            content,
            writer_id,
            writer_type,
            branch_id,
            views,
            is_visible,
            created_at,
            updated_at
        )
        VALUES
        (
            #{postType},
            #{title},
            #{content},
            #{writerId},
            #{writerType},
            #{branchId},
            #{views},
            #{isVisible},
            NOW(),
            NOW()
        )

    </insert>

    <!-- =========================
         공지사항 수정 (ADMIN)
    ========================= -->
    <update id="updateNotice"
            parameterType="com.project.app.notice.dto.NoticeDto">

        UPDATE community_post
        SET
            title = #{title},
            content = #{content},
            branch_id = #{branchId},
            updated_at = NOW()
        WHERE post_id = #{postId}
          AND post_type = 'NOTICE'

    </update>

    <!-- =========================
         공지사항 숨김 / 보이기 (ADMIN)
         - is_visible만 사용
    ========================= -->
    <update id="updateVisible">

        UPDATE community_post
        SET
            is_visible = #{visible},
            updated_at = NOW()
        WHERE post_id = #{postId}
          AND post_type = 'NOTICE'

    </update>

    <!-- =========================
         공지사항 삭제 (ADMIN)
         - 논리 삭제
         - is_visible = false
    ========================= -->
   <delete id="deleteNotice">

    DELETE FROM community_post
    WHERE post_id = #{postId}
      AND post_type = 'NOTICE'

   </delete>

</mapper>
